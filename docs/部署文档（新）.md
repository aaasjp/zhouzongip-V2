![1766552662558](image/部署文档（新）/1766552662558.png)

**服务器**: 国创H200 10.249.238.111

## 1. 文档解析服务

```bash
cd /data/gaoguanip_project
docker run --runtime nvidia --gpus '"device=2"' --name gaoguanip-document-parser --shm-size=16G --network=host -itd \
  crpi-14w4py2o64ex3hc2.cn-qingdao.personal.cr.aliyuncs.com/songjianping2022/document-parser:new \
  /workspace/start_services.sh
```

## 2. 向量库服务

```bash
docker load -i milvus-etcd.tar 
docker load -i milvus-minio.tar 
docker load -i milvus-standalone.tar 
docker-compose up -d
```

## 3. 文件存储服务 (MinIO)

```bash
mkdir -p /data/gaoguanip_project/miniodata

docker run -d \
  --name gaoguanip-minio \
  -p 19000:9000 \
  -p 19001:9001 \
  -v /data/gaoguanip_project/miniodata:/data \
  -e "MINIO_ROOT_USER=minioadmin" \
  -e "MINIO_ROOT_PASSWORD=minioadmin123" \
  minio/minio:latest server /data --address ":9000" --console-address ":9001"
```

## 4. MySQL服务

```bash
cd /data/gaoguanip_project
cat > my.cnf << EOF
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
skip-character-set-client-handshake = ON
EOF

docker run -d \
  --name gaoguanip-mysql \
  --restart=unless-stopped \
  -e MYSQL_ROOT_PASSWORD=root123 \
  -e MYSQL_DATABASE=gaoguanip \
  -e MYSQL_USER=admin \
  -e MYSQL_PASSWORD=admin123 \
  -e TZ=Asia/Shanghai \
  -p 3306:3306 \
  -v /data/gaoguanip_project/mysql-data:/var/lib/mysql \
  -v /data/gaoguanip_project/my.cnf:/etc/mysql/conf.d/custom.cnf \
  mysql:8.0 \
  --character-set-server=utf8mb4 \
  --collation-server=utf8mb4_unicode_ci \
  --default-authentication-plugin=mysql_native_password
```

## 5. 后端API服务
```bash
docker build -f Dockerfile.embedding -t gaoguanip-embedding-image:20251224 . 
```

```bash
docker load -i gaoguanip-image-20251224.tar
docker tag <IMAGE_ID> gaoguanip-api:20251224

docker run -d \
  --name gaoguanip-api \
  --restart=unless-stopped \
  --runtime nvidia --gpus '"device=2"' \
  -p 8002:8002 \
  -p 8003:8003 \
  -v /data/gaoguanip_project/models/bge-large-zh-v1.5:/data/gaoguanip_project/models/bge-large-zh-v1.5:ro \
  -v /data/gaoguanip_project/logs:/workspace/logs \
  gaoguanip-api:20251224
```

## 6. Web前端配置

在 `vite.config.js` 中配置代理：

```javascript
proxy: {
  '/vector_db_service': {
    target: 'http://10.249.238.111:8003',
    changeOrigin: true
  },
  '/chat_service': {
    target: 'http://10.249.238.111:8003',
    changeOrigin: true
  }
}
```
